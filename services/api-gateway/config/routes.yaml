# config/routes.yaml
version: "1.0"

routes:
  # ============================================
  # AUTHENTICATION ROUTES (No Auth Required)
  # ============================================
  
  - path: /api/v1/auth/register
    method: POST
    target: identity-service:8080
    stripPrefix: /api/v1
    auth: false
    timeout: 10000
    rateLimit:
      points: 1000
      duration: 3600

  - path: /api/v1/auth/login
    method: POST
    target: identity-service:8080
    stripPrefix: /api/v1
    auth: false
    timeout: 5000
    rateLimit:
      points: 1000
      duration: 60

  - path: /api/v1/auth/refresh
    method: POST
    target: identity-service:8080
    stripPrefix: /api/v1
    auth: false
    timeout: 5000

  - path: /api/v1/auth/verify-email
    method: POST
    target: identity-service:8080
    stripPrefix: /api/v1
    auth: false

  - path: /api/v1/auth/forgot-password
    method: POST
    target: identity-service:8080
    stripPrefix: /api/v1
    auth: false
    rateLimit:
      points: 3
      duration: 3600  # 3 requests per hour

  - path: /api/v1/auth/reset-password
    method: POST
    target: identity-service:8080
    stripPrefix: /api/v1
    auth: false

  # ============================================
  # AUTHENTICATED ROUTES
  # ============================================

  - path: /api/v1/auth/logout
    method: POST
    target: identity-service:8080
    stripPrefix: /api/v1
    auth: true

  - path: /api/v1/auth/change-password
    method: POST
    target: identity-service:8080
    stripPrefix: /api/v1
    auth: true

  # ============================================
  # USER ROUTES
  # ============================================

  - path: /api/v1/users/me
    method: [GET, PUT, PATCH]
    target: user-service:8080
    stripPrefix: /api/v1
    auth: true
    rateLimit:
      points: 100
      duration: 60

  - path: /api/v1/users/me/avatar
    method: POST
    target: user-service:8080
    stripPrefix: /api/v1
    auth: true
    timeout: 30000  # 30 seconds for file upload
    maxBodySize: "5MB"

  - path: /api/v1/users/me/preferences
    method: [GET, PUT]
    target: user-service:8080
    stripPrefix: /api/v1
    auth: true

  - path: /api/v1/users/search
    method: GET
    target: user-service:8080
    stripPrefix: /api/v1
    auth: true
    cache:
      enabled: true
      ttl: 300  # 5 minutes

  - path: /api/v1/users/admin/*
    method: [GET, POST]
    target: user-service:8080
    stripPrefix: /api/v1
    auth: true

  - path: /api/v1/users/:id
    method: GET
    target: user-service:8080
    stripPrefix: /api/v1
    auth: false # Public profile
    cache:
      enabled: true
      ttl: 300 # 5 minutes

  # ============================================
  # GYM ROUTES
  # ============================================

  - path: /api/v1/gyms/search
    method: GET
    target: gym-service:8080
    stripPrefix: /api/v1
    auth: false  # Public search
    cache:
      enabled: true
      ttl: 300

  - path: /api/v1/gyms/my
    method: GET
    target: gym-service:8080
    stripPrefix: /api/v1
    auth: true

  - path: /api/v1/gyms/*
    method: [GET, POST, PUT, PATCH, DELETE]
    target: gym-service:8080
    stripPrefix: /api/v1
    auth: true

  # ============================================
  # TRAINER ROUTES
  # ============================================

  - path: /api/v1/trainers/*
    method: [GET, POST, PUT, DELETE]
    target: trainer-service:8080
    stripPrefix: /api/v1
    auth: true

  - path: /api/v1/schedule/*
    method: [GET, POST, DELETE]
    target: trainer-service:8080
    stripPrefix: /api/v1
    auth: true

  # ============================================
  # CHAT ROUTES
  # ============================================

  - path: /api/v1/conversations/*
    method: [GET, POST, PUT, DELETE]
    target: chat-service:8080
    stripPrefix: /api/v1
    auth: true

  - path: /api/v1/messages/*
    method: [PUT, DELETE]
    target: chat-service:8080
    stripPrefix: /api/v1
    auth: true

  - path: /api/v1/chat/*
    method: GET
    target: chat-service:8080
    stripPrefix: /api/v1
    auth: true
    protocol: websocket

  # ============================================
  # MEDIA ROUTES
  # ============================================

  - path: /api/v1/media/upload
    method: POST
    target: media-service:8084
    stripPrefix: /api/v1
    auth: true
    timeout: 60000  # 1 minute for large files
    maxBodySize: "50MB"
    rateLimit:
      points: 50
      duration: 3600  # 50 uploads per hour

  # ============================================
  # SOCIAL ROUTES
  # ============================================

  - path: /api/v1/social/*
    method: [GET, POST, DELETE]
    target: social-service:8080
    stripPrefix: /api/v1
    auth: true
    timeout: 5000

  # ============================================
  # FEED ROUTES
  # ============================================

  - path: /api/v1/feed/*
    method: [GET]
    target: feed-service:8080
    stripPrefix: /api/v1
    auth: true
    timeout: 5000

  # ============================================
  # PAYMENT ROUTES
  # ============================================

  - path: /api/v1/payments/webhooks/*
    method: [POST]
    target: payment-service:8080
    stripPrefix: /api/v1/payments
    auth: false
    timeout: 5000
    rateLimit:
      points: 30
      duration: 60
    maxBodySize: "1MB"

  - path: /api/v1/payments/*
    method: [POST]
    target: payment-service:8080
    stripPrefix: /api/v1
    auth: true
    timeout: 10000